<div id="review-modal" class="hidden fixed inset-0 bg-slate-900 bg-opacity-60 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
    <h2 class="text-xl font-bold mb-4">Оставить отзыв</h2>
    <%= form_with url: seller_review_path(seller_id: @user.id), local: true, scope: :review do |f| %>
      <div class="mb-4">
        <label class="block text-sm font-medium mb-2">Оценка</label>
        <div class="flex space-x-1" id="star-rating">
          <% (1..5).each do |i| %>
            <%= f.radio_button :rating, i, class: "hidden", id: "rating_#{i}" %>
            <label for="rating_#{i}"
                   class="text-2xl cursor-pointer text-gray-300 star-label"
                   data-value="<%= i %>">
              ★
            </label>
          <% end %>
        </div>
      </div>
      <div class="mb-4">
        <%= f.label :text, "Комментарий", class: "block text-sm font-medium mb-2" %>
        <%= f.text_area :text, rows: 3, class: "w-full border rounded p-2", required: true %>
      </div>
      <div class="flex justify-end space-x-2">
        <button type="button"
                onclick="document.getElementById('review-modal').classList.add('hidden')"
                class="px-4 py-2 border rounded">Отмена</button>
        <%= f.submit "Отправить", class: "px-4 py-2 bg-blue-600 text-white rounded" %>
      </div>
    <% end %>
  </div>
</div>

<script>
    document.addEventListener('turbo:load', function() {
        const starLabels = document.querySelectorAll('.star-label');
        if (starLabels.length === 0) return;

        function updateStars(selectedValue) {
            starLabels.forEach(star => {
                const starValue = parseInt(star.getAttribute('data-value'), 10);
                if (starValue <= selectedValue) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300');
                }
            });
            const radio = document.getElementById(`rating_${selectedValue}`);
            if (radio) radio.checked = true;
        }

        updateStars(1);

        starLabels.forEach(label => {
            label.addEventListener('click', function() {
                const value = parseInt(this.getAttribute('data-value'), 10);
                updateStars(value);
            });
        });
    });
</script>