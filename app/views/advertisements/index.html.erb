<% if flash[:notice] %>
  <div class="fixed top-4 right-4 z-50">
    <div class="rounded-lg bg-green-50 p-4 shadow-lg animate-slide-in">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <p class="text-sm font-medium text-green-800"><%= flash[:notice] %></p>
        </div>
      </div>
    </div>
  </div>
<% end %>

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50">
  <% provide :navbar_title, "–ë–ê–†–ê–•–õ–ê.–ù–ï–¢!" %>
  <%= render "layouts/navbar" %>

  <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
    <!-- –®–∞–ø–∫–∞: –ü–æ–∏—Å–∫ + –ö–Ω–æ–ø–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
      <!-- –ü–æ–∏—Å–∫ -->
      <div class="flex-1">
        <%= render "advertisements/search_form" %>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ "–§–∏–ª—å—Ç—Ä—ã" (–≤–∏–¥–Ω–∞ –≤—Å–µ–≥–¥–∞) -->
      <button
        type="button"
        id="toggle-filters-btn"
        class=" lg:hidden inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
        </svg>
        –§–∏–ª—å—Ç—Ä—ã
        <span class="ml-1 bg-blue-100 text-blue-800 text-xs font-medium px-2 py-0.5 rounded-full">
          <%= filter_count %>
        </span>
      </button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: –§–∏–ª—å—Ç—Ä—ã + –°–ø–∏—Å–æ–∫ -->
    <div class="flex flex-col lg:flex-row gap-6">
      <!-- üéõ –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
      <div
        id="filters-sidebar"
        class="hidden lg:block w-full lg:w-80 flex-shrink-0 bg-white rounded-xl shadow-md p-5 h-fit"
      >
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-900">–§–∏–ª—å—Ç—Ä—ã</h3>
        <button
          type="button"
          id="close-filters-btn"
          class="lg:hidden text-gray-400 hover:text-gray-500"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <%= render "advertisements/filters", cities: @cities %>
    </div>

    <!-- üìã –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç: –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
    <div class="flex-1 w-full">
      <% if @advertisements&.any? %>
        <%= render "advertisements/table", advertisements: @advertisements, current_user: current_user %>
      <% else %>
        <div class="bg-white rounded-xl shadow-md p-12 text-center">
          <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <h3 class="text-lg font-medium text-gray-900 mb-2">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
          <p class="text-gray-500 max-w-md mx-auto">
            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.
          </p>
          <%= link_to "–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã", advertisements_path,
          class: "mt-4 inline-flex items-center text-blue-600 hover:text-blue-800 font-medium" %>
        </div>
      <% end %>

      <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
      <% if @advertisements.respond_to?(:total_pages) && @advertisements.total_pages > 1 %>
        <div class="mt-6">
          <%= paginate @advertisements, theme: 'tailwind' %>
        </div>
      <% end %>
    </div>
  </div>
</div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleBtn = document.getElementById('toggle-filters-btn');
        const sidebar = document.getElementById('filters-sidebar');
        const closeBtn = document.getElementById('close-filters-btn');

        if (!toggleBtn || !sidebar) return;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
        function toggleSidebar() {
            if (window.innerWidth < 1024) {
                // –ú–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
                sidebar.classList.toggle('hidden');

                if (!sidebar.classList.contains('hidden')) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
                    sidebar.classList.add('fixed', 'inset-0', 'z-50', 'overflow-y-auto');

                    // –î–æ–±–∞–≤–ª—è–µ–º overlay
                    const overlay = document.createElement('div');
                    overlay.id = 'sidebar-overlay';
                    overlay.className = 'fixed inset-0 bg-black bg-opacity-30 z-40';
                    document.body.appendChild(overlay);

                    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay
                    overlay.addEventListener('click', toggleSidebar);

                    // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª body
                    document.body.style.overflow = 'hidden';
                } else {
                    // –°–∫—Ä—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
                    sidebar.classList.remove('fixed', 'inset-0', 'z-50', 'overflow-y-auto');

                    // –£–¥–∞–ª—è–µ–º overlay
                    const overlay = document.getElementById('sidebar-overlay');
                    if (overlay) overlay.remove();

                    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª body
                    document.body.style.overflow = '';
                }
            } else {
                // –î–µ—Å–∫—Ç–æ–ø —Ä–µ–∂–∏–º - –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º hidden
                sidebar.classList.toggle('hidden');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        toggleBtn.addEventListener('click', toggleSidebar);

        if (closeBtn) {
            closeBtn.addEventListener('click', toggleSidebar);
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∞–≤–∏—à–µ Esc
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !sidebar.classList.contains('hidden') && window.innerWidth < 1024) {
                toggleSidebar();
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 1024 && sidebar.classList.contains('fixed')) {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã
                sidebar.classList.remove('fixed', 'inset-0', 'z-50', 'overflow-y-auto');
                sidebar.classList.add('lg:block');

                // –£–¥–∞–ª—è–µ–º overlay
                const overlay = document.getElementById('sidebar-overlay');
                if (overlay) overlay.remove();

                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª
                document.body.style.overflow = '';
            }
        });
    });
</script>