<!-- app/views/advertisements/_filters.erb -->

<div class="bg-white rounded-xl shadow-md p-5 mb-6">
  <%= form_with url: advertisements_path, method: :get, local: true, id: "filters-form", class: "space-y-6" do |f| %>
    <!-- üî∑ –û–°–ù–û–í–ù–´–ï –§–ò–õ–¨–¢–†–´ -->
    <div>
      <h5 class="font-medium text-gray-900 mb-3 pb-2 border-b">–û—Å–Ω–æ–≤–Ω–æ–µ</h5>
      <div class="space-y-4">
        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div class="w-full">
          <%= f.label :category_id, "–ö–∞—Ç–µ–≥–æ—Ä–∏—è", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <div class="w-full">
            <%= f.select :category_id,
                         options_for_select([["–õ—é–±–∞—è", ""]] + (Advertisement::CATEGORIES || {}).map { |id, name| [name, id] }, params[:category_id]),
                         {},
                         { class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                           id: "category-select" } %>
          </div>
        </div>

        <!-- –ì–æ—Ä–æ–¥ -->
        <div class="w-full">
          <%= f.label :city_id, "–ì–æ—Ä–æ–¥", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <div class="w-full">
            <%= f.select :city_id,
                         options_for_select([["–õ—é–±–æ–π", ""]] + (City.all.map { |c| [c.name, c.id] }), params[:city_id]),
                         {},
                         class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          </div>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å -->
        <div class="w-full">
          <%= f.label :status, "–°—Ç–∞—Ç—É—Å", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <div class="w-full">
            <%= f.select :status,
                         options_for_select([
                                              ["–õ—é–±–æ–π", ""],
                                              ["–ê–∫—Ç–∏–≤–Ω—ã–µ", "active"],
                                              ["–ü—Ä–æ–¥–∞–Ω–æ", "sold"]
                                            ], params[:status]),
                         {},
                         class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          </div>
        </div>

        <!-- –¶–µ–Ω–∞ -->
        <div class="w-full">
          <div class="block text-sm font-medium text-gray-700 mb-1">–¶–µ–Ω–∞</div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="w-full">
              <%= f.label :min_price, "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞", class: "block text-sm text-gray-700 mb-1" %>
              <%= f.number_field :min_price,
                                 value: params[:min_price],
                                 min: 0,
                                 placeholder: "0",
                                 class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
            </div>
            <div class="w-full">
              <%= f.label :max_price, "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞", class: "block text-sm text-gray-700 mb-1" %>
              <%= f.number_field :max_price,
                                 value: params[:max_price],
                                 min: 0,
                                 placeholder: "100 000",
                                 class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- üî∑ –ö–ê–¢–ï–ì–û–†–ò–ô–ù–´–ï –§–ò–õ–¨–¢–†–´ -->
    <div>
      <h5 class="font-medium text-gray-900 mb-3 pb-2 border-b" id="category-filters-title">
        <%= category_filter_title(params[:category_id]) %>
      </h5>

      <div id="category-filters" class="space-y-4">
        <!-- –§–∏–ª—å—Ç—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –≤—ã–±—Ä–∞–Ω–∞) -->
        <div id="filters-default" class="<%= 'hidden' if params[:category_id].present? %>">
          <div class="text-gray-500 text-sm py-8 text-center">
            –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.
          </div>
        </div>

        <!-- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 1) -->
        <div id="filters-category-1" class="category-filters <%= 'hidden' unless params[:category_id] == '1' %>">
          <%= render partial: "filters/transport_filters", locals: { f: f } %>
        </div>

        <!-- –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 2) -->
        <div id="filters-category-2" class="category-filters <%= 'hidden' unless params[:category_id] == '2' %>">
          <%= render partial: "filters/real_estate_filters", locals: { f: f } %>
        </div>

        <!-- –£—Å–ª—É–≥–∏ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 3) -->
        <div id="filters-category-3" class="category-filters <%= 'hidden' unless params[:category_id] == '3' %>">
          <%= render partial: "filters/service_filters", locals: { f: f } %>
        </div>

        <!-- –í–µ—â–∏ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 4) -->
        <div id="filters-category-4" class="category-filters <%= 'hidden' unless params[:category_id] == '4' %>">
          <%= render partial: "filters/thing_filters", locals: { f: f } %>
        </div>

        <!-- –†–∞–±–æ—Ç–∞ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 5) -->
        <div id="filters-category-5" class="category-filters <%= 'hidden' unless params[:category_id] == '5' %>">
          <%= render partial: "filters/job_filters", locals: { f: f } %>
        </div>
      </div>
    </div>

    <!-- üî∑ –ö–ù–û–ü–ö–ò -->
    <div class="pt-4">
      <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
        <div class="w-full sm:w-auto">
          <%= f.submit "–ü—Ä–∏–º–µ–Ω–∏—Ç—å",
                       class: "px-5 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition w-full" %>
        </div>
        <div class="w-full sm:w-auto">
          <%= link_to "–°–±—Ä–æ—Å–∏—Ç—å", advertisements_path,
                      class: "px-5 py-2.5 text-gray-700 bg-gray-100 hover:bg-gray-200 font-medium rounded-lg text-center w-full" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const categorySelect = document.getElementById('category-select');
        const categoryFiltersTitle = document.getElementById('category-filters-title');

        if (categorySelect) {
            function updateCategoryFilters() {
                const selectedCategory = categorySelect.value;

                document.querySelectorAll('.category-filters').forEach(el => {
                    el.classList.add('hidden');
                });

                const defaultFilters = document.getElementById('filters-default');
                if (selectedCategory) {
                    defaultFilters.classList.add('hidden');
                } else {
                    defaultFilters.classList.remove('hidden');
                }

                if (selectedCategory) {
                    const targetFilters = document.getElementById(`filters-category-${selectedCategory}`);
                    if (targetFilters) {
                        targetFilters.classList.remove('hidden');
                    }
                }

                updateCategoryTitle(selectedCategory);
            }

            function updateCategoryTitle(categoryId) {
                const titles = {
                    '1': '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
                    '2': '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å',
                    '3': '–£—Å–ª—É–≥–∏',
                    '4': '–í–µ—â–∏',
                    '5': '–†–∞–±–æ—Ç–∞'
                };

                if (categoryFiltersTitle) {
                    categoryFiltersTitle.textContent = titles[categoryId] || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ';
                }
            }

            categorySelect.addEventListener('change', updateCategoryFilters);
            updateCategoryFilters();
        }
    });
</script>