<!-- app/views/advertisements/_filters.erb -->
<div class="flex justify-between items-center mb-4 pb-2 border-b">
  <h4 class="font-medium text-gray-900">–§–∏–ª—å—Ç—Ä—ã</h4>
  <%= link_to "–°–±—Ä–æ—Å–∏—Ç—å", advertisements_path, class: "text-sm text-blue-600 hover:text-blue-700" %>
</div>

<div class="bg-white rounded-xl shadow-md p-5 mb-6">
  <%= form_with url: advertisements_path, method: :get, local: true, id: "filters-form", class: "space-y-6" do |f| %>
    <!-- üî∑ –î–í–ï –ö–û–õ–û–ù–ö–ò -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- üîπ –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
      <div>
        <h5 class="font-medium text-gray-900 mb-3 pb-2 border-b">–û—Å–Ω–æ–≤–Ω–æ–µ</h5>
        <div class="space-y-4">
          <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
          <div>
            <%= f.label :category_id, "–ö–∞—Ç–µ–≥–æ—Ä–∏—è", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.select :category_id,
                         options_for_select([["–õ—é–±–∞—è", ""]] + (Advertisement::CATEGORIES || {}).map { |id, name| [name, id] }, params[:category_id]),
                         {},
                         { class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                           id: "category-select" } %>
          </div>

          <!-- –ì–æ—Ä–æ–¥ -->
          <div>
            <%= f.label :city_id, "–ì–æ—Ä–æ–¥", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.select :city_id,
                         options_for_select([["–õ—é–±–æ–π", ""]] + (City.all.map { |c| [c.name, c.id] }), params[:city_id]),
                         {},
                         class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          </div>

          <!-- –°—Ç–∞—Ç—É—Å -->
          <div>
            <%= f.label :status, "–°—Ç–∞—Ç—É—Å", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.select :status,
                         options_for_select([
                                              ["–õ—é–±–æ–π", ""],
                                              ["–ê–∫—Ç–∏–≤–Ω—ã–µ", "active"],
                                              ["–ü—Ä–æ–¥–∞–Ω–æ", "sold"]
                                            ], params[:status]),
                         {},
                         class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
          </div>

          <!-- –¶–µ–Ω–∞ -->
          <div>
            <div class="block text-sm font-medium text-gray-700 mb-1">–¶–µ–Ω–∞</div>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <%= f.label :min_price, "–æ—Ç", class: "block text-xs text-gray-500 mb-1" %>
                <%= f.number_field :min_price,
                                   value: params[:min_price],
                                   min: 0,
                                   placeholder: "0",
                                   class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
              </div>
              <div>
                <%= f.label :max_price, "–¥–æ", class: "block text-xs text-gray-500 mb-1" %>
                <%= f.number_field :max_price,
                                   value: params[:max_price],
                                   min: 0,
                                   placeholder: "100 000",
                                   class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- üîπ –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ö–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
      <div>
        <h5 class="font-medium text-gray-900 mb-3 pb-2 border-b" id="category-filters-title">
          <%= category_filter_title(params[:category_id]) %>
        </h5>

        <div id="category-filters">
          <!-- –í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —Å—Ä–∞–∑—É, –Ω–æ —Å–∫—Ä—ã—Ç—ã -->

          <!-- –§–∏–ª—å—Ç—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –≤—ã–±—Ä–∞–Ω–∞) -->
          <div id="filters-default" class="<%= 'hidden' if params[:category_id].present? %>">
            <div class="text-gray-500 text-sm py-8 text-center">
              –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.
            </div>
          </div>

          <!-- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 1) -->
          <div id="filters-category-1" class="category-filters <%= 'hidden' unless params[:category_id] == '1' %>">
            <%= render partial: "filters/transport_filters", locals: { f: f } %>
          </div>

          <!-- –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 2) -->
          <div id="filters-category-2" class="category-filters <%= 'hidden' unless params[:category_id] == '2' %>">
            <%= render partial: "filters/real_estate_filters", locals: { f: f } %>
          </div>

          <!-- –£—Å–ª—É–≥–∏ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 3) - —Å–æ–∑–¥–∞–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª -->
          <div id="filters-category-3" class="category-filters <%= 'hidden' unless params[:category_id] == '3' %>">
            <%= render partial: "filters/service_filters", locals: { f: f } %>
          </div>

          <!-- –í–µ—â–∏ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 4) -->
          <div id="filters-category-4" class="category-filters <%= 'hidden' unless params[:category_id] == '4' %>">
            <%= render partial: "filters/thing_filters", locals: { f: f } %>
          </div>

          <!-- –†–∞–±–æ—Ç–∞ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è 5) -->
          <div id="filters-category-5" class="category-filters <%= 'hidden' unless params[:category_id] == '5' %>">
            <%= render partial: "filters/job_filters", locals: { f: f } %>
          </div>
        </div>
      </div>
    </div>

    <div class="pt-4 flex flex-col  sm:justify-end gap-3">
      <%= f.submit "–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",
                   class: "px-5 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition" %>
      <%= link_to "–°–±—Ä–æ—Å–∏—Ç—å", advertisements_path,
                  class: "px-5 py-2.5 text-gray-700 bg-gray-100 hover:bg-gray-200 font-medium rounded-lg text-center" %>
    </div>
  <% end %>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const categorySelect = document.getElementById('category-select');
        const categoryFiltersTitle = document.getElementById('category-filters-title');

        if (categorySelect) {
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            function updateCategoryFilters() {
                const selectedCategory = categorySelect.value;

                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                document.querySelectorAll('.category-filters').forEach(el => {
                    el.classList.add('hidden');
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                const defaultFilters = document.getElementById('filters-default');
                if (selectedCategory) {
                    defaultFilters.classList.add('hidden');
                } else {
                    defaultFilters.classList.remove('hidden');
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                if (selectedCategory) {
                    const targetFilters = document.getElementById(`filters-category-${selectedCategory}`);
                    if (targetFilters) {
                        targetFilters.classList.remove('hidden');
                    }
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                updateCategoryTitle(selectedCategory);
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
            function updateCategoryTitle(categoryId) {
                const titles = {
                    '1': '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
                    '2': '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å',
                    '3': '–£—Å–ª—É–≥–∏',
                    '4': '–í–µ—â–∏',
                    '5': '–†–∞–±–æ—Ç–∞'
                };

                if (categoryFiltersTitle) {
                    categoryFiltersTitle.textContent = titles[categoryId] || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ';
                }
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            categorySelect.addEventListener('change', updateCategoryFilters);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            updateCategoryFilters();
        }
    });
</script>